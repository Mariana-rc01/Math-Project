<!DOCTYPE html>
<html>
<head>
		<title>Gráficos Interativos</title>
		<!-- Incluir os arquivos JavaScript e CSS do Plotly -->
		<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
		<style>
				/* Estilo para a div do gráfico 3D */
				#plotly-graph-3d {
						width: 70%;
						float: left;
				}

				/* Estilo para a div do gráfico de curvas de nível */
				#plotly-graph-contour {
						width: 30%;
						float: right;
				}

				/* Estilo para a barra de deslizar */
				.slider-container {
						display: flex;
						align-items: center;
				}

				.slider {
						flex: 1;
				}

				.slider-value {
						width: 40px;
						margin-left: 10px;
						text-align: center;
				}
		</style>
</head>
<body>
		<h1>Gráficos 3D Interativos com Curvas de Nível</h1>
		<!-- Formulário para entrada de valores de a, b e quantidade de curvas de nível -->
		<form oninput="updateGraph()">
				<label for="a">Valor de a:</label>
				<input type="number" id="a" step="0.1" value="1"><br>
				<label for="b">Valor de b:</label>
				<input type="number" id="b" step="0.1" value="1"><br>
				<div class="slider-container">
						<label for="curves">Quantidade de Curvas de Nível:</label>
						<input
								type="radio"
								id="single-curve"
								name="curves-option"
								value="single"
								checked
								onchange="toggleCurveOptions()"
						>
						<label for="single-curve">Apenas uma curva de nível</label>
						<input
								type="radio"
								id="many-curves"
								name="curves-option"
								value="many"
								onchange="toggleCurveOptions()"
						>
						<label for="many-curves">Muitas curvas de nível</label>
						<br>
						<div id="level-slider-container">
								<label for="level">Valor da Curva de Nível:</label>
								<input
										type="range"
										id="level"
										class="slider"
										min="0"
										max="40"
										step="0.1"
										value="2"
										oninput="updateSliderValue()"
								>
								<input
										type="number"
										id="level-value"
										class="slider-value"
										min="0"
										max="40"
										step="0.1"
										value="2"
										oninput="updateSliderValue()"
								>
						</div>
						<div id="curves-slider-container">
								<label for="curves">Quantidade de Curvas de Nível:</label>
								<input
										type="range"
										id="curves"
										class="slider"
										min="1"
										max="50"
										value="10"
										oninput="updateSliderValue()"
								>
								<input
										type="number"
										id="curves-value"
										class="slider-value"
										min="1"
										max="50"
										value="10"
										oninput="updateSliderValue()"
								>
						</div>
				</div>
		</form>

		<!-- Divs onde os gráficos serão exibidos -->
		<div id="plotly-graph-3d"></div>
		<div id="plotly-graph-contour"></div>

		<script type="text/javascript">
				// Função para calcular os valores de z (f(x, y)) com base nos valores de x, y, a e b
				function f(x, y, a, b) {
						return a * x**2 + b * y**2;
				}

				// Função para calcular as curvas de nível com base nos valores de x, y, a e b
				function contourLevels(x, y, a, b) {
						var Z = [];
						for (var i = 0; i < x.length; i++) {
								var z_row = [];
								for (var j = 0; j < y.length; j++) {
										z_row.push(f(x[i], y[j], a, b));
								}
								Z.push(z_row);
						}
						return Z;
				}

				// Função para criar o plano de curvas de nível no primeiro gráfico 3D
				function createContourPlane(x, y, a, b, c) {
						var Z = contourLevels(x, y, a, b);
						var Z_masked = Z.map((row) => row.map((val) => (val >= c ? c : NaN)));

						return {
								type: 'surface',
								x: y,
								y: x,
								z: Z_masked,
								colorscale: 'Reds',
								showscale: false,
								opacity: 0.3,
								hoverinfo: 'none',
						};
				}

				// Função para criar os cortes horizontais nas posições das curvas de nível no gráfico 2D
				function createCuts(x, y, a, b, c_values) {
						var cuts = [];
						var Z = contourLevels(x, y, a, b);
						for (var c of c_values) {
								var trace = {
										type: 'scatter',
										mode: 'lines',
										x: y,
										y: Z.map((row) => row.map((val) => (val >= c ? c : NaN))),
										line: { color: 'black' },
										legendgroup: 'curves',
										showlegend: false,
								};
								cuts.push(trace);
						}
						return cuts;
				}

				// Função para criar o corte horizontal na posição da curva de nível escolhida no gráfico 2D
				function createSingleCut(x, y, a, b, c) {
						var Z = contourLevels(x, y, a, b);
						var trace = {
								type: 'scatter',
								mode: 'lines',
								x: y,
								y: Z.map((row) => row.map((val) => (val >= c ? c : NaN))),
								line: { color: 'red', width: 2 },
								legendgroup: 'curves',
								showlegend: false,
						};
						return trace;
				}

				// Função para atualizar os gráficos com base nos valores de a, b, e quantidade de curvas de nível ou valor da curva de nível
				function updateGraph() {
						// Check the selected option (apenas uma curva or muitas curvas)
						var singleCurveOption = document.getElementById('single-curve');
						var isSingleCurveOption = singleCurveOption.checked;

						// Obter os valores de a, b, e quantidade de curvas de nível do formulário
						var a = parseFloat(document.getElementById('a').value) || 1; // Valor padrão de 1 para 'a'
						var b = parseFloat(document.getElementById('b').value) || 1; // Valor padrão de 1 para 'b'
						var curves = parseInt(
								document.getElementById('curves-value').value
						); // Valor padrão de 1 para quantidade de curvas de nível se a caixa estiver vazia
						var level = parseFloat(
								document.getElementById('level-value').value
						); // Valor da curva de nível para a opção de uma curva

						// Atualizar o valor da quantidade de curvas de nível na barra de deslizar
						document.getElementById('curves').value = curves;
						// Atualizar o valor da curva de nível na barra de deslizar
						document.getElementById('level').value = level;

						// Intervalo de valores para x e y
						var x = [],
								y = [];
						for (var i = -5; i <= 5; i += 0.1) {
								x.push(i);
								y.push(i);
						}

						// c values for contour lines
						var c_values = [];
						var Z = contourLevels(x, y, a, b);
						var minZ = Math.min(...Z.flat());
						var maxZ = Math.max(...Z.flat());

						if (isSingleCurveOption) {
								// For the single curve option, use the level value to update the contour plane
								c_values.push(level);

								// Create the single cut for the 2D contour graph
								var singleCut = createSingleCut(x, y, a, b, level);

								// Criação dos dados dos gráficos
								var dataContour = [
										{
												type: 'contour',
												x: y,
												y: x,
												z: contourLevels(x, y, a, b),
												colorscale: 'Viridis',
												zmin: minZ,
												zmax: maxZ,
										},
										singleCut,
								];
						} else {
								// For the many curves option, generate c_values based on the number of curves
								for (var k = 0; k < curves; k++) {
										c_values.push(minZ + (k / (curves - 1)) * (maxZ - minZ));
								}

								// Criação dos cortes horizontais no gráfico 2D
								var cuts = createCuts(x, y, a, b, c_values);

								// Criação dos dados dos gráficos
								var dataContour = [
										{
												type: 'contour',
												x: y,
												y: x,
												z: contourLevels(x, y, a, b),
												colorscale: 'Viridis',
												zmin: minZ,
												zmax: maxZ,
										},
								].concat(cuts);
						}

						// Criação dos planos de curvas de nível
						var planes = [];
						for (var c of c_values) {
								planes.push(createContourPlane(x, y, a, b, c));
						}

						// Criação dos dados do gráfico 3D
						var data3d = [
								{
										type: 'surface',
										x: y,
										y: x,
										z: contourLevels(x, y, a, b),
										colorscale: 'Viridis',
								},
						].concat(planes);

						// Definição das opções de layout dos gráficos
						var layout3d = {
								title: 'Gráfico 3D Interativo',
								xaxis_title: 'Y',
								yaxis_title: 'X',
								zaxis_title: 'Z',
								scene: {
										camera: {
												eye: { x: 1.2, y: 1.2, z: 0.7 },
										},
								},
						};

						var layoutContour = {
								title: 'Gráfico de Curvas de Nível',
								xaxis_title: 'Y',
								yaxis_title: 'X',
								yaxis: {
										type: 'linear',
										range: [-5, 5],
								},
								scene: {
										camera: {
												eye: { x: 1.2, y: 1.2, z: 0.7 },
										},
								},
						};

						// Atualização dos gráficos
						Plotly.react('plotly-graph-3d', data3d, layout3d);
						Plotly.react('plotly-graph-contour', dataContour, layoutContour);
				}

				// Atualizar valor da quantidade de curvas de nível ou valor da curva de nível ao mover as barras de deslizar
				function updateSliderValue() {
						var curvesSliderContainer = document.getElementById(
								'curves-slider-container'
						);
						var levelSliderContainer = document.getElementById(
								'level-slider-container'
						);
						var curvesValue = document.getElementById('curves').value;
						var levelValue = document.getElementById('level').value;
						var curvesValueInput = document.getElementById('curves-value');
						var levelValueInput = document.getElementById('level-value');

						curvesValueInput.value = curvesValue;
						levelValueInput.value = levelValue;

						// Update the graph
						updateGraph();
				}

				// Alternar opções de quantidade de curvas de nível e valor da curva de nível
				function toggleCurveOptions() {
						var singleCurveOption = document.getElementById('single-curve');
						var levelSliderContainer = document.getElementById(
								'level-slider-container'
						);
						var curvesSliderContainer = document.getElementById(
								'curves-slider-container'
						);

						if (singleCurveOption.checked) {
								levelSliderContainer.style.display = 'block';
								curvesSliderContainer.style.display = 'none';
						} else {
								levelSliderContainer.style.display = 'none';
								curvesSliderContainer.style.display = 'block';
						}
						updateGraph();
				}

				// Atualizar os gráficos inicialmente
				updateGraph();
		</script>
</body>
</html>
