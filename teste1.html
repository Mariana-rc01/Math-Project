<!DOCTYPE html>
<html>
<head>
	<title>Gráfico 3D com Curvas de Nível</title>
	<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
	<style>
		.container {
			display: flex;
		}

		.graph {
			width: 70%;
		}

		.modebar-container {
			display: none !important;
		}
	</style>
</head>
<body>
	<div class="container">
		<div id="graph1" class="graph"></div>
		<div id="graph2" class="graph"></div>
	</div>

	<script>
		// Definition of the function f
		function f(x, y, a, b) {
			return a * x ** 2 + b * y ** 2;
		}

		// Range of values for x and y
		var resolution = 50; // Adjust the resolution as needed
		var x = Array.from({ length: resolution }, (_, i) => -5 + (i / (resolution - 1)) * 10);
		var y = Array.from({ length: resolution }, (_, i) => -5 + (i / (resolution - 1)) * 10);

		// Default values for a and b
		var a = 1;
		var b = 1;

		// Z values (f(x, y)) for x and y values
		var Z = [];
		for (var i = 0; i < x.length; i++) {
			var row = [];
			for (var j = 0; j < y.length; j++) {
				row.push(f(x[i], y[j], a, b));
			}
			Z.push(row);
		}

		// c values for contour lines
		var c_values = [];
		var minZ = Math.min(...Z.flat());
		var maxZ = Math.max(...Z.flat());
		for (var k = 0; k < 10; k++) {
			c_values.push(minZ + (k / 9) * (maxZ - minZ));
		}

		// Plot of graphs of f(x, y) and level curves
		var data1 = [
			{
				type: "surface",
				x: y, // Switched x and y here
				y: x, // Switched x and y here
				z: Z,
				colorscale: "Viridis",
				opacity: 0.5,
				showscale: false // Disable colorscale
			}
		];

		var layout1 = {
			title: "Gráfico de f(x, y)",
			scene: {
				xaxis: { title: "Y" }, // Changed x-axis title to "Y"
				yaxis: { title: "X" }, // Changed y-axis title to "X"
				zaxis: { title: "Z" }
			},
			width: 500,
			height: 500,
			hovermode: false, // Disable hovermode
			annotations: [
				{
					x: 0.5,
					y: 1.15,
					xref: "paper",
					yref: "paper",
					text: "Valor de a: " + a,
					showarrow: false
				},
				{
					x: 0.5,
					y: 1.1,
					xref: "paper",
					yref: "paper",
					text: "Valor de b: " + b,
					showarrow: false
				}
			]
		};

		Plotly.newPlot("graph1", data1, layout1);

		// Contours in rectangular planes
		var data2 = [
			{
				type: "contour",
				x: x,
				y: y,
				z: Z,
				colorscale: "Viridis",
				ncontours: 1, // Start with only one contour
				showscale: false // Disable colorscale
			}
		];

		var layout2 = {
			title: "Curvas de Nível",
			xaxis: { title: "X" },
			yaxis: { title: "Y" },
			width: 500,
			height: 500
		};

		Plotly.newPlot("graph2", data2, layout2);

		function updateGraph() {
			a = parseFloat(document.getElementById("a").value);
			b = parseFloat(document.getElementById("b").value);

			// Update Z values with new a and b
			for (var i = 0; i < x.length; i++) {
				for (var j = 0; j < y.length; j++) {
					Z[i][j] = f(x[i], y[j], a, b);
				}
			}

			// Update surface plot
			Plotly.update("graph1", { z: [Z] });

			// Update contour plot
			var contours = document.getElementById("contourMode").value;
			Plotly.update("graph2", { ncontours: contours, z: [Z] });

			// Add masked surfaces with new a and b
			if (contours > 1) {
				for (var m = 0; m < c_values.length; m++) {
					var mask = Z.map(row => row.map(val => val >= c_values[m]));
					var Z_masked = Z.map((row, i) => row.map((val, j) => (mask[i][j] ? c_values[m] : NaN)));

					var trace = {
						type: "surface",
						x: y, // Switched x and y here
						y: x, // Switched x and y here
						z: Z_masked,
						colorscale: "Reds",
						showscale: false,
						opacity: 0.3,
						hoverinfo: "none"
					};

					Plotly.addTraces("graph1", trace);
				}
			}

			// Update annotations with new values of a and b
			Plotly.relayout("graph1", {
				annotations: [
					{
						x: 0.5,
						y: 1.15,
						xref: "paper",
						yref: "paper",
						text: "Valor de a: " + a,
						showarrow: false
					},
					{
						x: 0.5,
						y: 1.1,
						xref: "paper",
						yref: "paper",
						text: "Valor de b: " + b,
						showarrow: false
					}
				]
			});
		}
	</script>

	<div>
		<label for="a">Valor de a:</label>
		<input type="number" id="a" value="1" />
	</div>
	<div>
		<label for="b">Valor de b:</label>
		<input type="number" id="b" value="1" />
	</div>
	<div>
		<label for="contourMode">Modo de Curvas de Nível:</label>
		<select id="contourMode" onchange="updateGraph()">
			<option value="1">Apenas uma curva de nível</option>
			<option value="30">Diversas curvas de nível</option>
		</select>
	</div>

	<div id="hoverinfo" style="position: absolute; top: 20px; left: 550px;"></div>
</body>
</html>
